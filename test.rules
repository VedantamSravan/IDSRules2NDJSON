alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba smbd flags2 header parsing denial of service attempt"; flow:to_server,established; flowbits:isset,smb.req.ascii; content:"|FF|SMB|73 00 00 00 00|"; depth:9; offset:4; byte_test:1,!&,0x40,0,relative,little; byte_test:2,&,0x8000,1,relative,little; metadata:policy max-detect-ips drop, service netbios-ssn; reference:bugtraq,40097; reference:cve,2010-1635; classtype:attempted-dos; sid:17152; rev:10;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba username map script command injection attempt"; flow:to_server,established; content:"|FF|SMBs"; depth:5; offset:4; content:"|00 00|"; within:3; distance:2; content:"|00|"; within:1; distance:25; content:"|00 00 00 00|"; within:4; distance:16; byte_extract:2,-8,ansi_pw_len,relative,little; byte_jump:2,0,relative,little,post_offset 10; content:"/="; within:2; distance:ansi_pw_len; pcre:"/^[x21-x2fx3a-x3fx5b-x60x7b-x7e]/R"; metadata:service netbios-ssn; reference:cve,2007-2447; reference:url,labs.idefense.com/intelligence/vulnerabilities/display.php?id=534 ; classtype:attempted-admin; sid:21164; rev:5;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [445,139] (msg:"SERVER-SAMBA Samba wildcard filename matching denial of service attempt"; flow:to_server,established; content:"|FF|SMB2"; depth:5; offset:4; content:"|01 00|"; depth:2; offset:65; content:"*"; distance:0; pcre:"/((x3cx00?)*x2ax00?[^x2ax3c]*){5}/R"; reference:bugtraq,11624; reference:cve,2004-0930; classtype:attempted-dos; sid:15581; rev:4;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba Root File System access bypass attempt"; flow:to_server,established; content:"|FF|SMB|75|"; depth:5; offset:4; byte_jump:1,27,relative,multiplier 2; byte_jump:2,-2,relative,little; content:"|5C 00 5C 00|"; within:4; distance:2; content:"|5C 00 00 00|"; within:80; pcre:"/x5cx00x5cx00[^x5c]*?x5cx00x00x00/"; metadata:policy max-detect-ips drop, service netbios-ssn; reference:bugtraq,33118; reference:cve,2009-0022; classtype:attempted-recon; sid:17639; rev:9;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba SID parsing overflow attempt"; flow:to_server,established; content:"|FF|SMB|A0|"; content:"|14|"; within:1; distance:27; content:"|07 00|"; within:2; distance:36; byte_test:1,>,15,32,relative; metadata:policy max-detect-ips drop, service netbios-ssn; reference:bugtraq,43212; reference:cve,2010-3069; classtype:attempted-admin; sid:19007; rev:8;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba name mangling buffer overflow attempt"; flow:to_server,established; content:"|FF|SMB"; fast_pattern; byte_test:2,>,1024,67,little; byte_extract:2,67,bcc,little; content:"~"; within:bcc; pcre:"/^x00.{3}xffSMB[x02x03x06x07x08x09x0fx29x2ax2dx82x83x84xa2xa5].{61}[x5cx2f]x00?(.x00?)+?[x5cx2f]x00?(.x00?){5}x7ex00?(.x00?){2}x2Ex00?(.x00?){3}(?!x00x00?)/"; metadata:service netbios-ssn; reference:bugtraq,10781; reference:cve,2004-0686; classtype:attempted-admin; sid:21370; rev:4;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [135,139,445,593,1024:] (msg:"SERVER-SAMBA Samba DCERPC NCACN-IP-TCP lsarpc LsarLookupSids lsa_io_trans_name heap overflow attempt"; flow:to_server,established; dce_iface:12345778-1234-abcd-ef00-0123456789ab; dce_opnum:15; dce_stub_data; content:"|05 00 00 00 88 88 88 88 09 00 00 00|"; depth:12; offset:52; metadata:service netbios-ssn; reference:bugtraq,24196; reference:cve,2007-2446; classtype:protocol-command-decode; sid:18319; rev:8;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba malicious user defined array size and buffer attempt"; flow:to_server,established; dce_iface:82273fdc-e32a-18c3-3f78-827929dc23ea; dce_opnum:11; dce_stub_data; byte_extract:2,32,array_elements,multiplier 1,dce; byte_test:4,<,array_elements,2,relative,dce; metadata:policy balanced-ips drop, policy connectivity-ips drop, policy security-ips drop, service netbios-ssn; reference:cve,2012-1182; reference:url,www.samba.org/samba/security/CVE-2012-1182; classtype:attempted-admin; sid:23240; rev:4;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba malicious user defined array size and buffer attempt"; flow:to_server,established; dce_iface:82273fdc-e32a-18c3-3f78-827929dc23ea; dce_opnum:11; dce_stub_data; byte_extract:4,40,array_elements,multiplier 4,dce; byte_test:2,<,array_elements,-8,relative,dce; metadata:policy balanced-ips drop, policy connectivity-ips drop, policy security-ips drop, service netbios-ssn; reference:cve,2012-1182; reference:url,www.samba.org/samba/security/CVE-2012-1182; classtype:attempted-admin; sid:22008; rev:4;)
alert tcp $EXTERNAL_NET any -> $HOME_NET [139,445] (msg:"SERVER-SAMBA Samba malicious user defined array size and buffer attempt"; flow:to_server,established; dce_iface:4fc742e0-4a10-11cf-8273-00aa004ae673; dce_opnum:3; dce_stub_data; byte_extract:4,44,num_stores,dce; byte_test:4,<,num_stores,4,relative,dce; metadata:policy balanced-ips drop, policy connectivity-ips drop, policy security-ips drop, service netbios-ssn; reference:cve,2012-1182; reference:url,www.samba.org/samba/security/CVE-2012-1182; classtype:attempted-admin; sid:22012; rev:4;)
